/*
 fe-project-5 2016-02-23 
*/
function getZomato(a){var b,c='<div class="infowindow">'+a.description+".<p>(Zomato is not currently available).</p></div>";this.vendorData=Control.getVendor("Zomato");var d=this.vendorData[0].startUrl+a.locationID+"&apikey="+this.vendorData[0].key;$.getJSON(d,function(a){b='<div class="infowindow"><h3>'+a.name+"</h3><p>"+a.location.address+"<br><strong>Cuisine:</strong> "+a.cuisines+"<br><strong>Average Cost for Two:</strong> $"+a.average_cost_for_two+"</br><strong>Average Zomato Rating:</strong> "+a.user_rating.aggregate_rating+" ("+a.user_rating.rating_text+')</p><p id="vendor-credits"><a href="'+a.url+'" target="new">Powered by Zomato</a></p><div>',"https://b.zmtcdn.com/images/res_avatar_120_1x_new.png"!==a.thumb&&(b=b+'<div class=infowindow><p><img src="'+a.thumb+'"></p></div>')}).done(function(){infowindow.setContent(b)}).fail(function(){infowindow.setContent(c)})}function getYelp(a){function b(){for(var a="",b="0123456789",c=0;9>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}var c,d='<div class="infowindow">'+a.description+".<p>(Yelp is not currently available).</p></div>";this.vendorData=Control.getVendor("Yelp");var e="GET",f=vendorData[0].startUrl+a.locationID,g={oauth_consumer_key:this.vendorData[0].key.oauth_consumer_key,oauth_token:this.vendorData[0].key.oauth_token,oauth_nonce:b(),oauth_timestamp:Math.round((new Date).getTime()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb"},h=vendorData[0].key.consumerSecret,i=vendorData[0].key.tokenSecret,j=oauthSignature.generate(e,f,g,h,i),k=(oauthSignature.generate(e,f,g,h,i,{encodeSignature:!1}),f+"?oauth_consumer_key="+g.oauth_consumer_key+"&oauth_nonce="+g.oauth_nonce+"&oauth_signature_method="+g.oauth_signature_method+"&oauth_timestamp="+g.oauth_timestamp+"&oauth_token="+g.oauth_token+"&oauth_version="+g.oauth_version+"&oauth_signature="+j);$.ajax({type:"GET",url:k,cache:!0,jsonpCallback:"cb",dataType:"jsonp",success:function(a){c='<div class="infowindow"><h3>'+a.name+"</h3><p>"+a.location.display_address+"<br>Phone: "+a.display_phone+'<br><img src="'+a.rating_img_url+'"><br><strong>Rating:</strong> '+a.rating+'</p><p id="vendor-credits"><a href="'+a.url+'" target="new">Visit our Yelp Page</a></p><br><img src="'+a.image_url+'"><div>'}}).done(function(){infowindow.setContent(c)}).fail(function(){infowindow.setContent(d)})}function initMap(){function a(){b=map.getCenter()}map=new google.maps.Map(document.getElementById("map"),{zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},scaleControl:!0,streetViewControl:!0,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}});var b;google.maps.event.addDomListener(map,"idle",function(){a()}),google.maps.event.addDomListener(window,"resize",function(){map.setCenter(b)});var c=Control.getMyCoords(),d=new google.maps.LatLngBounds(new google.maps.LatLng(c[0].south,c[0].west),new google.maps.LatLng(c[0].north,c[0].east));map.fitBounds(d),allPlaces=Control.getAllPlaces(),initMarkers(allPlaces,c,d),initInfoWindow()}function googleError(){mapFailMessage(!0)}function initInfoWindow(){infowindow=new google.maps.InfoWindow({maxWidth:275})}function initMarkers(a,b,c){for(var d=0;d<a.length;d++){this.place=a[d];var e="./pix/"+place.icon;marker=new google.maps.Marker({animation:google.maps.Animation.DROP,position:place.position,map:map,icon:e,title:place.title}),c.extend(marker.position),marker.addListener("click",function(a){return function(){Control.setCurrentPlace(a),match(a)}}(place)),markers.push(marker),map.fitBounds(c)}}function match(a){for(var b=0;b<markers().length;b++)markers()[b].title==a.title&&(marker=markers()[b],map.panTo({lat:a.position.lat,lng:a.position.lng}),infowindow.open(map,marker),toggleBounce(a,marker),"Zomato"===a.source?getZomato(a):"Yelp"===a.source&&getYelp(a))}function toggleBounce(){null!==marker.getAnimation()?marker.setAnimation(null):(marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){marker.setAnimation(null)},750))}function ViewModel(){function a(a){a.matches?d.showMenu(!0):d.showMenu(!1)}function b(a){var b,c=a.length,d=[],e={};for(b=0;c>b;b++)e[a[b]]=0;for(b in e)d.push(b);return d}var c,d=this,e=!1;d.filterStr=ko.observable(""),d.showMenu=ko.observable(c),d.showCredits=ko.observable(e),d.noMatches=ko.observable(0);for(var f=Control.getAllPlaces(),g=0;g<f.length;g++)f[g].visible=ko.observable(!0);if(d.places=ko.observableArray(f),matchMedia){var h=window.matchMedia("(min-width: 600px)");h.addListener(a),a(h)}for(this.toggleMenu=function(){return c=!c,d.showMenu(c)},this.toggleCredits=function(){return c=!c,d.showCredits(c)},this.showAll=function(){this.noMatches(0);for(var a=0;a<this.places().length;a++)this.places()[a].visible(!0),markers()[a].setMap(map)},this.filter=function(a){this.noMatches(0);for(var b=0,c=this.filterStr().toLowerCase(),e=0;e<this.places().length;e++){this.places()[e].visible(!0),markers()[e].setMap(map),d.placeStr=this.places()[e].description.toLowerCase()+" "+this.places()[e].title.toLowerCase()+" "+this.places()[e].type.toLowerCase()+" "+this.places()[e].keys.toLowerCase();var f=d.placeStr.search(c);-1==f&&(this.places()[e].visible(!1),markers()[e].setMap(null)),b+=f}document.getElementById("filter").reset(),this.filterStr(""),b==-1*this.places().length&&(this.showAll(),this.noMatches(1))},this.autoFillStr="",g=0;g<this.places().length;g++)d.autoFillStr+=this.places()[g].keys+" "+this.places()[g].type+" ";var i=d.autoFillStr.split(" "),j=b(i),k={data:j,list:{match:{enabled:!0}},theme:"dark"};$("#search").easyAutocomplete(k)}var Model={currentPlace:null,myPlaces:[{position:{lat:35.883324,lng:-84.524148},map:map,title:"Mama Mia's Restaurant-Pizzeria",description:"Mama Mia's: Thin crust pizza and 70s decor",locationID:17269784,source:"Zomato",type:"Restaurant",keys:"pizza Italian Mama-Mia's",icon:"pizza.png"},{position:{lat:35.885723,lng:-84.497461},map:map,title:"Gloria Jean's Restaurant",description:"Gloria Jean's: Southern cooking and hospitality",locationID:"gloria-jeans-kingston",source:"Yelp",type:"Restaurant",keys:"burgers sandwiches southern pie Gloria-Jean's",icon:"dinner.png"},{position:{lat:35.882102,lng:-84.505977},map:map,title:"Don Eduardo's Mexican Grill",description:"Don Eduardo's: A bit salty. Water, please?",locationID:17270326,source:"Zomato",type:"Restaurant",keys:"bar tequila beer Don-Eduardo's",icon:"dinner.png"},{position:{lat:35.87776,lng:-84.511819},map:map,title:"Mei Wei Chinese Restaurant",description:"Mei Wei: Far East food in Near East Tennessee",locationID:"17269786",source:"Zomato",type:"Restaurant",keys:"Chinese Asian Mei-Wei",icon:"dinner.png"},{position:{lat:35.874415,lng:-84.515031},map:map,title:"Handee Burger",description:"Handee Burger: Greasy, but no spoons",locationID:17269781,source:"Zomato",type:"Restaurant",keys:"breakfast biscuits-n-gravy sliders Handee-Burger",icon:"hamburger.png"},{position:{lat:35.8611,lng:-84.527949},map:map,title:"Fort Southwest Point",description:"Fort Southwest Point: An early American fort",locationID:"fort-southwest-point-kingston",source:"Yelp",type:"Park",keys:"museum history cannon Fort-Southwest-Point",icon:"cannon.png"},{position:{lat:35.870925,lng:-84.515573},map:map,title:"Kingston Barber Shop",description:"Kingston Barber Shop: A great place for your Elvis-related looks",locationID:"kingston-barber-shop-kingston-3",source:"Yelp",type:"Barber-Shop",keys:"barber haircut trim Kingston-Barber-Shop",icon:"barber.png"}],myVendors:[{vendor:"Zomato",key:"eae8f9e214a0616278ac70ef1df3dfce",startUrl:"https://developers.zomato.com/api/v2.1/restaurant?res_id="},{vendor:"Yelp",key:{oauth_consumer_key:"QTiph1Uz4Cpuw2kOa2sG3Q",oauth_token:"0gjDnn-g5CvZg-DOpgs4EuwJ2reEbVtN",consumerSecret:"YiK5tQt9n5ke2sSFQNof5GkJvHc",tokenSecret:"Edt0OgvUQHgQfqsP4HWeYkZaUT4"},startUrl:"https://api.yelp.com/v2/business/"}],myCoords:[{south:35.856494,west:-84.528388,north:35.886037,east:-84.507149}]},Control={setCurrentPlace:function(a){Model.currentPlace=a},getAllPlaces:function(){return Model.myPlaces},getVendor:function(a){for(var b=[],c=0;c<Model.myVendors.length;c++)Model.myVendors[c].vendor==a&&b.push(Model.myVendors[c]);return b},getMyCoords:function(){return Model.myCoords}},map,infowindow,allPlaces,markers=ko.observableArray(),mapFailMessage=ko.observable(!1);ko.applyBindings(new ViewModel);